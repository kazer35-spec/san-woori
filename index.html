window.loadMemberLogs = async () => {
    const id = document.getElementById('memberSelectEdit').value;
    const area = document.getElementById('logListArea'); 
    if(!area) return;
    area.innerHTML = ""; 
    if(!id) return;

    try {
        const snap = await getDocs(query(collection(db, `sanwoori/${id}/logs`), orderBy("date", "desc"), limit(20)));
        
        let htmlContent = ""; // ì„±ëŠ¥ê³¼ ë²„ê·¸ ë°©ì§€ë¥¼ ìœ„í•´ ë³€ìˆ˜ì— ë¨¼ì € ë‹´ìŠµë‹ˆë‹¤.
        snap.forEach(ld => {
            const logData = ld.data();
            const d = logData.date.toDate();
            const dateStr = `${d.getFullYear()}.${d.getMonth() + 1}.${d.getDate()}`;
            
            const logJson = JSON.stringify({
                mountain: logData.mountain || "",
                height: logData.height || 0,
                coords: logData.coords || null,
                isTop100: logData.isTop100 || false,
                isBAC: logData.isBAC || false,
                region: logData.region || "ê¸°íƒ€"
            }).replace(/"/g, '&quot;');

            htmlContent += `
                <div class="log-item-box" onclick="selectLogToMap('${logJson}')">
                    <div class="log-info-group">
                        <span class="log-date-txt">${dateStr}</span>
                        <button onclick="event.stopPropagation(); window.toggleFriendship('${id}', '${ld.id}', ${logData.isGroup ? false : true})" 
                            class="text-[9px] ${logData.isGroup ? 'bg-pink-500 text-white' : 'bg-slate-200 text-slate-500'} px-2 py-1 rounded-md font-bold mx-1">
                            ${logData.isGroup ? 'ğŸ’ ìš°ì •ON' : 'ğŸ‘¥ ìš°ì •OFF'}
                        </button>
                        <span class="log-mt-txt">${logData.isBAC ? '<span class="bac-txt">BAC</span>' : ''}${logData.mountain || 'ê¸°ë¡'}</span>
                    </div>
                    <div class="flex items-center gap-1">
                        <input type="number" id="h-${ld.id}" value="${logData.height || 0}" class="log-height-input border rounded-md" onclick="event.stopPropagation()">
                        <button onclick="event.stopPropagation(); updateLogHeight('${id}', '${ld.id}')" class="text-[9px] bg-slate-200 px-1 py-1 rounded">ë†’ì´ìˆ˜ì •</button>
                        <button onclick="event.stopPropagation(); updateLogCoord('${id}', '${ld.id}')" class="text-[9px] bg-emerald-500 text-white px-1 py-1 rounded">ì¢Œí‘œìˆ˜ì •</button>
                    </div>
                    <div class="log-btn-group">
                        <button class="del-btn-mini" onclick="event.stopPropagation(); deleteLog('${id}', '${ld.id}', true)">ë ˆë²¨-1 ì‚­ì œ</button>
                        <button class="del-only-btn-mini" onclick="event.stopPropagation(); deleteLog('${id}', '${ld.id}', false)">ê¸°ë¡ë§Œ ì‚­ì œ</button>
                    </div>
                </div>`;
        });
        area.innerHTML = htmlContent; // í•œ ë²ˆì— ì£¼ì…í•˜ì—¬ ë ˆì´ì•„ì›ƒ ê¹¨ì§ ë°©ì§€
    } catch (e) {
        console.error("ë¡œê·¸ ë¡œë“œ ì˜¤ë¥˜:", e);
    }
};
